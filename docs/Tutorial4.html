<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Tutorial_4 – DACSS758 Text as Data Fall 2025</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-c1fac2584b48ed01fb6e278e36375074.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">DACSS758 Text as Data Fall 2025</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Tutorial1.html"> 
<span class="menu-text">Tutorial1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Tutorial2.html"> 
<span class="menu-text">Tutorial2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Tutorial3.html"> 
<span class="menu-text">Tutorial3</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./Tutorial4.html" aria-current="page"> 
<span class="menu-text">Tutorial4</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#annotators-udpipe-spacy-and-corenlp" id="toc-annotators-udpipe-spacy-and-corenlp" class="nav-link active" data-scroll-target="#annotators-udpipe-spacy-and-corenlp">Annotators: udpipe, spacy, and CoreNLP</a></li>
  <li><a href="#nlp-in-r-with-cleannlp" id="toc-nlp-in-r-with-cleannlp" class="nav-link" data-scroll-target="#nlp-in-r-with-cleannlp">NLP in R with <code>cleanNLP</code></a></li>
  <li><a href="#annotation-cnlp_annotate" id="toc-annotation-cnlp_annotate" class="nav-link" data-scroll-target="#annotation-cnlp_annotate">Annotation: <code>cnlp_annotate()</code></a></li>
  <li><a href="#part-of-speech-tagging" id="toc-part-of-speech-tagging" class="nav-link" data-scroll-target="#part-of-speech-tagging">Part of Speech Tagging</a></li>
  <li><a href="#dependency-relations" id="toc-dependency-relations" class="nav-link" data-scroll-target="#dependency-relations">Dependency Relations</a></li>
  <li><a href="#visualizing-dependency-trees" id="toc-visualizing-dependency-trees" class="nav-link" data-scroll-target="#visualizing-dependency-trees">Visualizing Dependency Trees</a></li>
  <li><a href="#named-entity-recognition-ner" id="toc-named-entity-recognition-ner" class="nav-link" data-scroll-target="#named-entity-recognition-ner">Named Entity Recognition (NER)</a></li>
  <li><a href="#string-operations" id="toc-string-operations" class="nav-link" data-scroll-target="#string-operations">String Operations</a>
  <ul class="collapse">
  <li><a href="#whats-in-a-string" id="toc-whats-in-a-string" class="nav-link" data-scroll-target="#whats-in-a-string">What’s in a string?</a></li>
  <li><a href="#combining-strings" id="toc-combining-strings" class="nav-link" data-scroll-target="#combining-strings">Combining strings</a></li>
  <li><a href="#substrings" id="toc-substrings" class="nav-link" data-scroll-target="#substrings">Substrings</a></li>
  <li><a href="#pattern-searches" id="toc-pattern-searches" class="nav-link" data-scroll-target="#pattern-searches">Pattern searches</a></li>
  </ul></li>
  <li><a href="#regular-expressions" id="toc-regular-expressions" class="nav-link" data-scroll-target="#regular-expressions">Regular Expressions</a>
  <ul class="collapse">
  <li><a href="#classes-and-quantifiers" id="toc-classes-and-quantifiers" class="nav-link" data-scroll-target="#classes-and-quantifiers">Classes and quantifiers</a></li>
  <li><a href="#extracting-data" id="toc-extracting-data" class="nav-link" data-scroll-target="#extracting-data">Extracting data</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tutorial 4 Natural Language Processing</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll learn about doing standard natural language processing (NLP) tasks in R, and will be introduced to regular expressions. After completing this notebook, you should be familiar with:</p>
<ol type="1">
<li><p>Annotators: udpipe, spacy, and CoreNLP</p></li>
<li><p>NLP in R with <code>cleanNLP</code></p></li>
<li><p>Annotation: <code>cnlp_annotate()</code></p></li>
<li><p>Part of Speech Tagging</p></li>
<li><p>Dependency Relations</p></li>
<li><p>String Operations</p></li>
<li><p>Regular Expressions</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cleanNLP)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Package version: 4.3.1
Unicode version: 14.0
ICU version: 71.1
Parallel computing: disabled
See https://quanteda.io for tutorials and examples.</code></pre>
</div>
</div>
<section id="annotators-udpipe-spacy-and-corenlp" class="level1">
<h1>Annotators: udpipe, spacy, and CoreNLP</h1>
<p>The standard-bearer for NLP work is Stanford’s CoreNLP suite (<a href="https://stanfordnlp.github.io/CoreNLP/">available here</a>). Historically, that work was available in Java, with really ineffective ports to other programming languages. Fortunately, the past few years have seen major progress in making the suite more accessible in both Python and R. We’re going to leverage the best package with the best port to R — <code>cleanNLP</code> — for our NLP tasks.</p>
<p>Stanford’s CoreNLP, though, is just one of many NLP annotation tools available with <code>cleanNLP</code>. There are two important points to highlight related to this. First, in addition to CoreNLP, <code>cleanNLP</code> can leverage spacy, a high-powered Python library; spacy is (much) faster than CoreNLP, but with some cost in classification accuracy. Second, both CoreNLP and spacy require a Python installation on your machine. Because of that, we can’t run the CoreNLP or spacy code in R (it’s a long story). We will be able to use the universal dependencies pipe (udpipe), so that’s what we’ll do here.</p>
<p>More generally, though, you’ll want to have the capacity provided by CoreNLP or spacy available for your projects on your personal machine. Therefore, you need to install Python. I recommend installing Anaconda Python (<a href="https://www.anaconda.com/download">available here</a>). Once you’ve done that, you’ll need to install the cleanNLP module within Python.</p>
</section>
<section id="nlp-in-r-with-cleannlp" class="level1">
<h1>NLP in R with <code>cleanNLP</code></h1>
<p>To get started, you’ll need to initialize the NLP backend. We’ll be using the udpipe backend, which comes installed with the cleanNLP package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cnlp_init_udpipe</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have our NLP backend initialized and ready to roll. We’ll be using the U.S. Presidential Inaugural Address corpus, which comes pre-loaded with quanteda. The corpus is already in your workspace (since it is pre-loaded) as data_corpus_inaugural; it features speeches from 1789 to the present, with document variables indicating the year (Year) of the speech, the last name of the president (President), and their political party (Party).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pull the corpus as a character vector (which works with cleanNLP) rather than a corpus object, which does not.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> <span class="fu">as.character</span>(data_corpus_inaugural)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># To give you an idea of what these look like, here's Biden's speech</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>text[<span class="fu">length</span>(text)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 2025-Trump 
"Thank you.  Thank you very much, everybody.  Wow.  Thank you very, very much.\n\nVice President Vance, Speaker Johnson, Senator Thune, Chief Justice Roberts, justices of the Supreme Court of the United States, President Clinton, President Bush, President Obama, President Biden, Vice President Harris, and my fellow citizens, the golden age of America begins right now.\n\nFrom this day forward, our country will flourish and be respected again all over the world.  We will be the envy of every nation, and we will not allow ourselves to be taken advantage of any longer.  During every single day of the Trump administration, I will, very simply, put America first.\n\nOur sovereignty will be reclaimed.  Our safety will be restored.  The scales of justice will be rebalanced.  The vicious, violent, and unfair weaponization of the Justice Department and our government will end.\n\nAnd our top priority will be to create a nation that is proud, prosperous, and free.\n\nAmerica will soon be greater, stronger, and far more exceptional than ever before.\n\nI return to the presidency confident and optimistic that we are at the start of a thrilling new era of national success.  A tide of change is sweeping the country, sunlight is pouring over the entire world, and America has the chance to seize this opportunity like never before.\n\nBut first, we must be honest about the challenges we face.  While they are plentiful, they will be annihilated by this great momentum that the world is now witnessing in the United States of America.\n\nAs we gather today, our government confronts a crisis of trust.  For many years, a radical and corrupt establishment has extracted power and wealth from our citizens while the pillars of our society lay broken and seemingly in complete disrepair.\n\nWe now have a government that cannot manage even a simple crisis at home while, at the same time, stumbling into a continuing catalogue of catastrophic events abroad.\n\nIt fails to protect our magnificent, law-abiding American citizens but provides sanctuary and protection for dangerous criminals, many from prisons and mental institutions, that have illegally entered our country from all over the world.\n\nWe have a government that has given unlimited funding to the defense of foreign borders but refuses to defend American borders or, more importantly, its own people.\n\nOur country can no longer deliver basic services in times of emergency, as recently shown by the wonderful people of North Carolina — who have been treated so badly — (applause) — and other states who are still suffering from a hurricane that took place many months ago or, more recently, Los Angeles, where we are watching fires still tragically burn from weeks ago without even a token of defense.  They’re raging through the houses and communities, even affecting some of the wealthiest and most powerful individuals in our country — some of whom are sitting here right now.  They don’t have a home any longer.  That’s interesting.  But we can’t let this happen.  Everyone is unable to do anything about it.  That’s going to change.\n\nWe have a public health system that does not deliver in times of disaster, yet more money is spent on it than any country anywhere in the world.\n\nAnd we have an education system that teaches our children to be ashamed of themselves — in many cases, to hate our country despite the love that we try so desperately to provide to them.  All of this will change starting today, and it will change very quickly.\n\nMy recent election is a mandate to completely and totally reverse a horrible betrayal and all of these many betrayals that have taken place and to give the people back their faith, their wealth, their democracy, and, indeed, their freedom.  From this moment on, America’s decline is over.\n\nOur liberties and our nation’s glorious destiny will no longer be denied.  And we will immediately restore the integrity, competency, and loyalty of America’s government.\n\nOver the past eight years, I have been tested and challenged more than any president in our 250-year history, and I’ve learned a lot along the way.\n\nThe journey to reclaim our republic has not been an easy one — that, I can tell you.  Those who wish to stop our cause have tried to take my freedom and, indeed, to take my life.\n\nJust a few months ago, in a beautiful Pennsylvania field, an assassin’s bullet ripped through my ear.  But I felt then and believe even more so now that my life was saved for a reason.  I was saved by God to make America great again.\n\nThank you.  Thank you.\n\nThank you very much.\n\nThat is why each day under our administration of American patriots, we will be working to meet every crisis with dignity and power and strength.  We will move with purpose and speed to bring back hope, prosperity, safety, and peace for citizens of every race, religion, color, and creed.\n\nFor American citizens, January 20th, 2025, is Liberation Day.  It is my hope that our recent presidential election will be remembered as the greatest and most consequential election in the history of our country.\n\nAs our victory showed, the entire nation is rapidly unifying behind our agenda with dramatic increases in support from virtually every element of our society: young and old, men and women, African Americans, Hispanic Americans, Asian Americans, urban, suburban, rural.  And very importantly, we had a powerful win in all seven swing states — (applause) — and the popular vote, we won by millions of people.\n\nTo the Black and Hispanic communities, I want to thank you for the tremendous outpouring of love and trust that you have shown me with your vote.  We set records, and I will not forget it.  I’ve heard your voices in the campaign, and I look forward to working with you in the years to come.\n\nToday is Martin Luther King Day.  And his honor — this will be a great honor.  But in his honor, we will strive together to make his dream a reality.  We will make his dream come true.\n\nThank you.  Thank you.  Thank you.\n\nNational unity is now returning to America, and confidence and pride is soaring like never before.  In everything we do, my administration will be inspired by a strong pursuit of excellence and unrelenting success.  We will not forget our country, we will not forget our Constitution, and we will not forget our God.  Can’t do that.\n\nToday, I will sign a series of historic executive orders.  With these actions, we will begin the complete restoration of America and the revolution of common sense.  It’s all about common sense.\n\nFirst, I will declare a national emergency at our southern border.\n\nAll illegal entry will immediately be halted, and we will begin the process of returning millions and millions of criminal aliens back to the places from which they came.  We will reinstate my Remain in Mexico policy.\n\nI will end the practice of catch and release.\n\nAnd I will send troops to the southern border to repel the disastrous invasion of our country.\n\nUnder the orders I sign today, we will also be designating the cartels as foreign terrorist organizations.\n\nAnd by invoking the Alien Enemies Act of 1798, I will direct our government to use the full and immense power of federal and state law enforcement to eliminate the presence of all foreign gangs and criminal networks bringing devastating crime to U.S. soil, including our cities and inner cities.\n\nAs commander in chief, I have no higher responsibility than to defend our country from threats and invasions, and that is exactly what I am going to do.  We will do it at a level that nobody has ever seen before.\n\nNext, I will direct all members of my cabinet to marshal the vast powers at their disposal to defeat what was record inflation and rapidly bring down costs and prices.\n\nThe inflation crisis was caused by massive overspending and escalating energy prices, and that is why today I will also declare a national energy emergency.  We will drill, baby, drill.\n\nAmerica will be a manufacturing nation once again, and we have something that no other manufacturing nation will ever have — the largest amount of oil and gas of any country on earth — and we are going to use it.  We’ll use it.\n\nWe will bring prices down, fill our strategic reserves up again right to the top, and export American energy all over the world.\n\nWe will be a rich nation again, and it is that liquid gold under our feet that will help to do it.\n\nWith my actions today, we will end the Green New Deal, and we will revoke the electric vehicle mandate, saving our auto industry and keeping my sacred pledge to our great American autoworkers.\n\nIn other words, you’ll be able to buy the car of your choice.\n\nWe will build automobiles in America again at a rate that nobody could have dreamt possible just a few years ago.  And thank you to the autoworkers of our nation for your inspiring vote of confidence.  We did tremendously with their vote.\n\nI will immediately begin the overhaul of our trade system to protect American workers and families.  Instead of taxing our citizens to enrich other countries, we will tariff and tax foreign countries to enrich our citizens.\n\nFor this purpose, we are establishing the External Revenue Service to collect all tariffs, duties, and revenues.  It will be massive amounts of money pouring into our Treasury, coming from foreign sources.\n\nThe American dream will soon be back and thriving like never before.\n\nTo restore competence and effectiveness to our federal government, my administration will establish the brand-new Department of Government Efficiency.\n\nAfter years and years of illegal and unconstitutional federal efforts to restrict free expression, I also will sign an executive order to immediately stop all government censorship and bring back free speech to America.\n\nNever again will the immense power of the state be weaponized to persecute political opponents — something I know something about.  (Laughter.)  We will not allow that to happen.  It will not happen again.\n\nUnder my leadership, we will restore fair, equal, and impartial justice under the constitutional rule of law.\n\nAnd we are going to bring law and order back to our cities.\n\nThis week, I will also end the government policy of trying to socially engineer race and gender into every aspect of public and private life.  We will forge a society that is colorblind and merit-based.\n\nAs of today, it will henceforth be the official policy of the United States government that there are only two genders: male and female.\n\nThis week, I will reinstate any service members who were unjustly expelled from our military for objecting to the COVID vaccine mandate with full back pay.\n\nAnd I will sign an order to stop our warriors from being subjected to radical political theories and social experiments while on duty.  It’s going to end immediately.  Our armed forces will be freed to focus on their sole mission: defeating America’s enemies.\n\nLike in 2017, we will again build the strongest military the world has ever seen.  We will measure our success not only by the battles we win but also by the wars that we end — and perhaps most importantly, the wars we never get into.\n\nMy proudest legacy will be that of a peacemaker and unifier.  That’s what I want to be: a peacemaker and a unifier.\n\nI’m pleased to say that as of yesterday, one day before I assumed office, the hostages in the Middle East are coming back home to their families.\n\nThank you.\n\nAmerica will reclaim its rightful place as the greatest, most powerful, most respected nation on earth, inspiring the awe and admiration of the entire world.\n\nA short time from now, we are going to be changing the name of the Gulf of Mexico to the Gulf of America — (applause) — and we will restore the name of a great president, William McKinley, to Mount McKinley, where it should be and where it belongs.\n\nPresident McKinley made our country very rich through tariffs and through talent — he was a natural businessman — and gave Teddy Roosevelt the money for many of the great things he did, including the Panama Canal, which has foolishly been given to the country of Panama after the United Spates — the United States — I mean, think of this — spent more money than ever spent on a project before and lost 38,000 lives in the building of the Panama Canal.\n\nWe have been treated very badly from this foolish gift that should have never been made, and Panama’s promise to us has been broken.\n\nThe purpose of our deal and the spirit of our treaty has been totally violated.  American ships are being severely overcharged and not treated fairly in any way, shape, or form.  And that includes the United States Navy.\n\nAnd above all, China is operating the Panama Canal.  And we didn’t give it to China.  We gave it to Panama, and we’re taking it back.\n\nAbove all, my message to Americans today is that it is time for us to once again act with courage, vigor, and the vitality of history’s greatest civilization.\n\nSo, as we liberate our nation, we will lead it to new heights of victory and success.  We will not be deterred.  Together, we will end the chronic disease epidemic and keep our children safe, healthy, and disease-free.\n\nThe United States will once again consider itself a growing nation — one that increases our wealth, expands our territory, builds our cities, raises our expectations, and carries our flag into new and beautiful horizons.\n\nAnd we will pursue our manifest destiny into the stars, launching American astronauts to plant the Stars and Stripes on the planet Mars.\n\nAmbition is the lifeblood of a great nation, and, right now, our nation is more ambitious than any other.  There’s no nation like our nation.\n\nAmericans are explorers, builders, innovators, entrepreneurs, and pioneers.  The spirit of the frontier is written into our hearts.  The call of the next great adventure resounds from within our souls.\n\nOur American ancestors turned a small group of colonies on the edge of a vast continent into a mighty republic of the most extraordinary citizens on Earth.  No one comes close.\n\nAmericans pushed thousands of miles through a rugged land of untamed wilderness.  They crossed deserts, scaled mountains, braved untold dangers, won the Wild West, ended slavery, rescued millions from tyranny, lifted billions from poverty, harnessed electricity, split the atom, launched mankind into the heavens, and put the universe of human knowledge into the palm of the human hand.  If we work together, there is nothing we cannot do and no dream we cannot achieve.\n\nMany people thought it was impossible for me to stage such a historic political comeback.  But as you see today, here I am.  The American people have spoken.\n\nI stand before you now as proof that you should never believe that something is impossible to do.  In America, the impossible is what we do best.\n\nFrom New York to Los Angeles, from Philadelphia to Phoenix, from Chicago to Miami, from Houston to right here in Washington, D.C., our country was forged and built by the generations of patriots who gave everything they had for our rights and for our freedom.\n\nThey were farmers and soldiers, cowboys and factory workers, steelworkers and coal miners, police officers and pioneers who pushed onward, marched forward, and let no obstacle defeat their spirit or their pride.\n\nTogether, they laid down the railroads, raised up the skyscrapers, built great highways, won two world wars, defeated fascism and communism, and triumphed over every single challenge that they faced.\n\nAfter all we have been through together, we stand on the verge of the four greatest years in American history.  With your help, we will restore America promise and we will rebuild the nation that we love — and we love it so much.\n\nWe are one people, one family, and one glorious nation under God.  So, to every parent who dreams for their child and every child who dreams for their future, I am with you, I will fight for you, and I will win for you.  We’re going to win like never before.\n\nThank you.  Thank you.\n\nThank you.  Thank you.\n\nIn recent years, our nation has suffered greatly. But we are going to bring it back and make it great again, greater than ever before.\n\nWe will be a nation like no other, full of compassion, courage, and exceptionalism.  Our power will stop all wars and bring a new spirit of unity to a world that has been angry, violent, and totally unpredictable.\n\nAmerica will be respected again and admired again, including by people of religion, faith, and goodwill.  We will be prosperous, we will be proud, we will be strong, and we will win like never before.\n\nWe will not be conquered, we will not be intimidated, we will not be broken, and we will not fail.  From this day on, the United States of America will be a free, sovereign, and independent nation.\n\nWe will stand bravely, we will live proudly, we will dream boldly, and nothing will stand in our way because we are Americans.  The future is ours, and our golden age has just begun.\n\nThank you.  God bless America.  Thank you all.  Thank you.  Thank you very much.  Thank you very much.  Thank you.\n\nThank you." </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pull out the data we want</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>myData <span class="ot">&lt;-</span> <span class="fu">docvars</span>(data_corpus_inaugural)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(myData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Year  President FirstName                 Party
1 1789 Washington    George                  none
2 1793 Washington    George                  none
3 1797      Adams      John            Federalist
4 1801  Jefferson    Thomas Democratic-Republican
5 1805  Jefferson    Thomas Democratic-Republican
6 1809    Madison     James Democratic-Republican</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(myData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Year President FirstName      Party
55 2005      Bush George W. Republican
56 2009     Obama    Barack Democratic
57 2013     Obama    Barack Democratic
58 2017     Trump Donald J. Republican
59 2021     Biden Joseph R. Democratic
60 2025     Trump Donald J. Republican</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># now add the text to our data frame for running the annotation tool; column must be named `text`</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>myData<span class="sc">$</span>text <span class="ot">&lt;-</span> text</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The steps we take in the above get the data ready for use with the NLP package <code>cleanNLP</code>. This is, unfortunately, a common theme in R and other open-source programming languages. The ability for users to contribute their own packages means we have an enormous amount of flexibility and progress happens fast, but the trade off is that the different packages don’t always play well with one another. As you get more familiar with working in R, getting used to moving between the preferred formats of different packages becomes easier.</p>
<p>With that said, those simple steps above are all we need to do to get our texts ready for annotation with <code>cleanNLP</code>, which takes a vector of file names, a character vector with one document in each element, or a data frame as input. If we have a corpus — as we often do — we can convert it to a character vector as above and be ready to annotate.</p>
</section>
<section id="annotation-cnlp_annotate" class="level1">
<h1>Annotation: <code>cnlp_annotate()</code></h1>
<p>So, let’s annotate. The next line is going to take a few minutes so it’s a good chance to go take care of making that pot of coffee you forgot to make before starting this up.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>annotated <span class="ot">&lt;-</span> <span class="fu">cnlp_annotate</span>(myData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Processed document 10 of 60
Processed document 20 of 60
Processed document 30 of 60
Processed document 40 of 60
Processed document 50 of 60
Processed document 60 of 60</code></pre>
</div>
</div>
<p>The output for each of the backends is going to look a little bit different, though the general structure will be consistent. Here we can start seeing what our udpipe annotation looks like. The first thing to note is that it is a very particular type of object with two fields: token and document. Both are dataframes; token is a dataframe featuring the annotations from the text, while document is a dataframe featuring just the unique document IDs. We’ll primarily be interested in the former.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(annotated<span class="sc">$</span>token)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
  doc_id   sid tid   token    token_with_ws lemma   upos  xpos  feats tid_source
   &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;         &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;     
1      1     1 1     Fellow   "Fellow"      fellow  ADJ   JJ    Degr… 3         
2      1     1 2     -        "-"           -       PUNCT HYPH  &lt;NA&gt;  3         
3      1     1 3     Citizens "Citizens "   citizen NOUN  NNS   Numb… 0         
4      1     1 4     of       "of "         of      ADP   IN    &lt;NA&gt;  6         
5      1     1 5     the      "the "        the     DET   DT    Defi… 6         
6      1     1 6     Senate   "Senate "     Senate  PROPN NNP   Numb… 3         
# ℹ 1 more variable: relation &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(annotated<span class="sc">$</span>token)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
  doc_id   sid tid   token token_with_ws lemma upos  xpos  feats      tid_source
   &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;     
1     60   176 1     Thank "Thank "      thank VERB  VBP   Mood=Ind|… 0         
2     60   176 2     you   "you"         you   PRON  PRP   Case=Acc|… 1         
3     60   176 3     .     ".\n\n"       .     PUNCT .     &lt;NA&gt;       1         
4     60   177 1     Thank "Thank "      thank VERB  VBP   Mood=Ind|… 0         
5     60   177 2     you   "you"         you   PRON  PRP   Case=Acc|… 1         
6     60   177 3     .     "."           .     PUNCT .     &lt;NA&gt;       1         
# ℹ 1 more variable: relation &lt;chr&gt;</code></pre>
</div>
</div>
<p>If we wanted, we could create a single database from both of these using <code>doc_id</code> variable present in both. This is particularly helpful for downstream analyses we might want to do that would analyze — say — patterns over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>annoData <span class="ot">&lt;-</span> <span class="fu">left_join</span>(annotated<span class="sc">$</span>document, annotated<span class="sc">$</span>token, <span class="at">by =</span> <span class="st">"doc_id"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(annoData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Year  President FirstName Party doc_id sid tid    token token_with_ws   lemma
1 1789 Washington    George  none      1   1   1   Fellow        Fellow  fellow
2 1789 Washington    George  none      1   1   2        -             -       -
3 1789 Washington    George  none      1   1   3 Citizens     Citizens  citizen
4 1789 Washington    George  none      1   1   4       of           of       of
5 1789 Washington    George  none      1   1   5      the          the      the
6 1789 Washington    George  none      1   1   6   Senate       Senate   Senate
   upos xpos                     feats tid_source relation
1   ADJ   JJ                Degree=Pos          3     amod
2 PUNCT HYPH                      &lt;NA&gt;          3    punct
3  NOUN  NNS               Number=Plur          0     root
4   ADP   IN                      &lt;NA&gt;          6     case
5   DET   DT Definite=Def|PronType=Art          6      det
6 PROPN  NNP               Number=Sing          3     nmod</code></pre>
</div>
</div>
<p>Let’s discuss what this new annotated data set provides. First, note that speeches are now organized at the token level. Three variables help us to index this new level: doc_id, the number of the document in the corpus; sid, the number of the sentence within the document; and tid, the number of the token within the sentence. At a really basic level then, we can now figure out the number of sentences within each document, and the average length (in tokens) of those sentences. Here’s the former.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot length of documents (in sentences) over time</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>annoData <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Sentences =</span> <span class="fu">max</span>(sid)) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Year, Sentences)) <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Tutorial4_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is interesting and potentially useful information. Length is incredibly simple to estimate and has been used as a proxy in published research for, among other things, the <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2307352">complexity of public policies like the Affordable Care Act</a> and, in the case of judicial opinions, <a href="https://houstonlawreview.org/article/4873-an-empirical-analysis-of-the-length-of-u-s-supreme-court-opinions">a host of legal characteristics of interest (dicta, law clerk influence, etc.)</a>. Length is also often connected with readability statistics, which we will come to in later sections of the course.</p>
<p>That said, the real prize of the annotations are the details related to each individual token. The next three columns (token, token_with_ws, and lemma) all relate directly to the actual characters of the token. Take, as an example, “Citizens” (third row). The token is “Citizens”, while the lemma is a headword for a group of related words; here, “citizen” is the lemma of “Citizens” as it is the non-plural version of the token. To get an idea of how else lemmatization changes the tokens, here’s a comparison of the first 40 tokens in the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="fu">head</span>(annoData<span class="sc">$</span>token,<span class="dv">40</span>),</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">head</span>(annoData<span class="sc">$</span>lemma,<span class="dv">40</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]              [,2]             
 [1,] "Fellow"          "fellow"         
 [2,] "-"               "-"              
 [3,] "Citizens"        "citizen"        
 [4,] "of"              "of"             
 [5,] "the"             "the"            
 [6,] "Senate"          "Senate"         
 [7,] "and"             "and"            
 [8,] "of"              "of"             
 [9,] "the"             "the"            
[10,] "House"           "House"          
[11,] "of"              "of"             
[12,] "Representatives" "Representatives"
[13,] ":"               ":"              
[14,] "Among"           "among"          
[15,] "the"             "the"            
[16,] "vicissitudes"    "vicissitude"    
[17,] "incident"        "incident"       
[18,] "to"              "to"             
[19,] "life"            "life"           
[20,] "no"              "no"             
[21,] "event"           "event"          
[22,] "could"           "could"          
[23,] "have"            "have"           
[24,] "filled"          "fill"           
[25,] "me"              "I"              
[26,] "with"            "with"           
[27,] "greater"         "greater"        
[28,] "anxieties"       "anxiety"        
[29,] "than"            "than"           
[30,] "that"            "that"           
[31,] "of"              "of"             
[32,] "which"           "which"          
[33,] "the"             "the"            
[34,] "notification"    "notification"   
[35,] "was"             "be"             
[36,] "transmitted"     "transmit"       
[37,] "by"              "by"             
[38,] "your"            "you"            
[39,] "order"           "order"          
[40,] ","               ","              </code></pre>
</div>
</div>
<p>Lemmatization can be particularly useful as a pre-processing step in some analyses; topic modeling immediately comes to mind. The general reason is that references to different forms of the same underlying token (say, “transmit”, “transmitted”, “transmits”) all connote one related concept but are going to be treated as entirely distinct tokens if we were to say just look for the most frequent tokens in the corpus or in a speech. We’ll come back to this later this semester when we discuss stemming and other related pre-processing considerations.</p>
</section>
<section id="part-of-speech-tagging" class="level1">
<h1>Part of Speech Tagging</h1>
<p>Now we are into the heart of the annotations. Let’s highlight a chunk of the data to use as illustrations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First tokens from Trump's speech</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(annoData[<span class="fu">which</span>(annoData<span class="sc">$</span>Year <span class="sc">==</span> <span class="dv">2021</span>),<span class="dv">9</span><span class="sc">:</span><span class="dv">15</span>],<span class="dv">28</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        token_with_ws         lemma  upos xpos
149626         Chief          Chief PROPN  NNP
149627       Justice        Justice PROPN  NNP
149628        Roberts       Roberts PROPN  NNP
149629             ,              , PUNCT    ,
149630          Vice           Vice PROPN  NNP
149631     President      President PROPN  NNP
149632         Harris        Harris PROPN  NNP
149633             ,              , PUNCT    ,
149634       Speaker        speaker PROPN  NNP
149635         Pelosi        Pelosi PROPN  NNP
149636             ,              , PUNCT    ,
149637        Leader         leader PROPN  NNP
149638        Schumer       Schumer PROPN  NNP
149639             ,              , PUNCT    ,
149640        Leader         leader PROPN  NNP
149641      McConnell     McConnell PROPN  NNP
149642             ,              , PUNCT    ,
149643          Vice           Vice PROPN  NNP
149644     President      President PROPN  NNP
149645          Pence         Pence PROPN  NNP
149646             ,              , PUNCT    ,
149647 distinguished  distinguished   ADJ   JJ
149648         guests         guest  NOUN  NNS
149649             ,              , PUNCT    ,
149650           and            and CCONJ   CC
149651            my             my  PRON PRP$
149652        fellow         fellow   ADJ   JJ
149653      Americans     Americans PROPN NNPS
                                            feats tid_source  relation
149626                                Number=Sing          2  compound
149627                                Number=Sing          0      root
149628                                Number=Sing          2      flat
149629                                       &lt;NA&gt;          2     punct
149630                                Number=Sing          6  compound
149631                                Number=Sing          2      conj
149632                                Number=Sing          6      flat
149633                                       &lt;NA&gt;          9     punct
149634                                Number=Sing          2      conj
149635                                Number=Sing          9      flat
149636                                       &lt;NA&gt;         12     punct
149637                                Number=Sing          2      conj
149638                                Number=Sing         12      flat
149639                                       &lt;NA&gt;         15     punct
149640                                Number=Sing          2      conj
149641                                Number=Sing         15      flat
149642                                       &lt;NA&gt;         19     punct
149643                                Number=Sing         19  compound
149644                                Number=Sing          2      conj
149645                                Number=Sing         19      flat
149646                                       &lt;NA&gt;         23     punct
149647                                 Degree=Pos         23      amod
149648                                Number=Plur          2      conj
149649                                       &lt;NA&gt;         28     punct
149650                                       &lt;NA&gt;         28        cc
149651 Number=Sing|Person=1|Poss=Yes|PronType=Prs         28 nmod:poss
149652                                 Degree=Pos         28      amod
149653                                Number=Plur          2      conj</code></pre>
</div>
</div>
<p>Next, <em>upos</em> stands for the universal part of speech tag while <em>xpos</em> stands for the treebank-specific part of speech. You can find descriptions of each <em>upos</em> classification tag <a href="https://universaldependencies.org/u/pos/index.html">here</a>. Knowing the parts of speech, we could — at a really basic level — just look to see what nouns are most frequently used in presidential addresses overall, and in the most recent era (i.e., post 2000).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>annoData <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Party <span class="sc">==</span> <span class="st">"Republican"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">&gt;</span> <span class="dv">1980</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(upos <span class="sc">==</span> <span class="st">"NOUN"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(lemma) <span class="sc">%&gt;%</span> </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="at">n=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Selecting by count</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   lemma      count
   &lt;chr&gt;      &lt;int&gt;
 1 nation        73
 2 freedom       64
 3 world         61
 4 people        59
 5 government    58
 6 country       53
 7 time          53
 8 citizen       41
 9 day           39
10 today         38</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>annoData <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Party <span class="sc">==</span> <span class="st">"Democratic"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">&gt;</span> <span class="dv">1980</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(upos <span class="sc">==</span> <span class="st">"NOUN"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(lemma) <span class="sc">%&gt;%</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="at">n=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Selecting by count</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
   lemma      count
   &lt;chr&gt;      &lt;int&gt;
 1 nation        57
 2 world         51
 3 people        50
 4 time          41
 5 today         37
 6 century       27
 7 child         26
 8 life          24
 9 government    22
10 day           21
11 democracy     21
12 generation    21</code></pre>
</div>
</div>
<p>You can further distinguish parts of speech using the feats field, which references more specific “features” related to the parts of speech. More information on the features can be found <a href="https://universaldependencies.org/u/feat/index.html">here</a>.</p>
</section>
<section id="dependency-relations" class="level1">
<h1>Dependency Relations</h1>
<p>Finally, the relationships between tokens are captured in dependency relations, which are reflected by syntactic annotations through <code>tid_source</code> and <code>relation</code>. The goal of dependency relations is to form a generalizable structure of language that works across languages (thus, universal dependencies). If we want to capture meaning from many different texts in different languages (with all of the different customs of those particular languages), we would first want to have some generalizable structure about how words in languages fit together.</p>
<p>Consider a sentence like: <code>The child chased the dog down the hall.</code> The underlying idea behind dependency relations is to focus primarily on content words; in the above, that would be “child”, “chased”, “dog”, and “hall”. We can start to see how knowing <em>just</em> those four words gets us a long way to understanding what might be happening; if we can add in some sort of structure (say, that “child” is the nominal subject [nsubj], or the do-er of the action, and “dog” is the object [obj], or the receiver of the action) then we can recognize that a child chased a dog (rather than the much-less-cute reverse).</p>
<p>The full list of dependency relations and their abbreviations can be found <a href="https://universaldependencies.org/u/dep/">here</a>.</p>
<p>What can we do with dependency relations? At the simplest level, they can be features that we rely on for classification. For that matter, everything we’ve covered in this tutorial could be a feature. We’ll cover classifiers later this semester and will be able to explore this avenue a bit more then.</p>
<p>We could also, however, be more directly interested in using the dependency relations to study particular choices over word usage in texts. As an example, consider unique phrasings from President Trump’s 2017 speech and President Biden’s 2021 speech (for more on the approach here, see the <code>cleanNLP</code> documentation <a href="https://statsmaths.github.io/cleanNLP/state-of-union.html">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'magrittr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    set_names</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidyr':

    extract</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Biden 2021</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>annoData <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    annotated<span class="sc">$</span>token,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"doc_id"</span><span class="ot">=</span><span class="st">"doc_id"</span>, <span class="st">"sid"</span><span class="ot">=</span><span class="st">"sid"</span>, <span class="st">"tid"</span><span class="ot">=</span><span class="st">"tid_source"</span>),</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">suffix=</span><span class="fu">c</span>(<span class="st">""</span>, <span class="st">"_source"</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2021</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(relation <span class="sc">==</span> <span class="st">"obj"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">doc_id =</span> doc_id, <span class="at">start =</span> token, <span class="at">word =</span> token_source) <span class="sc">%&gt;%</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(word_frequency, <span class="at">by=</span><span class="st">"word"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(frequency <span class="sc">&lt;</span> <span class="fl">0.005</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(doc_id, start, word) <span class="sc">%$%</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sprintf</span>(<span class="st">"%s =&gt; %s"</span>, start, word)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "transfer =&gt; peaceful"   "resilience =&gt; strength" "President =&gt; spoke"    
 [4] "salute =&gt; lifetime"     "oath =&gt; sacred"         "oath =&gt; sworn"         
 [7] "virus =&gt; deadly"        "justice =&gt; racial"      "culture =&gt; manipulated"
[10] "women =&gt; brave"         "work =&gt; democracy"      "campaign =&gt; humbled"   
[13] "lesson =&gt; painful"      "war =&gt; uncivil"         "war =&gt; pits"           
[16] "tolerance =&gt; humility"  "what =&gt; toughest"       "alliances =&gt; engage"   
[19] "prayer =&gt; silent"       "attack =&gt; democracy"    "crises =&gt; cascading"   
[22] "crises =&gt; era"          "work =&gt; prayers"       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Trump 2025</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>annoData <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    annotated<span class="sc">$</span>token,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"doc_id"</span><span class="ot">=</span><span class="st">"doc_id"</span>, <span class="st">"sid"</span><span class="ot">=</span><span class="st">"sid"</span>, <span class="st">"tid"</span><span class="ot">=</span><span class="st">"tid_source"</span>),</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">suffix=</span><span class="fu">c</span>(<span class="st">""</span>, <span class="st">"_source"</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2025</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(relation <span class="sc">==</span> <span class="st">"obj"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">doc_id =</span> doc_id, <span class="at">start =</span> token, <span class="at">word =</span> token_source) <span class="sc">%&gt;%</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(word_frequency, <span class="at">by=</span><span class="st">"word"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(frequency <span class="sc">&lt;</span> <span class="fl">0.005</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(doc_id, start, word) <span class="sc">%$%</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sprintf</span>(<span class="st">"%s =&gt; %s"</span>, start, word)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "nation =&gt; proud"             "chance =&gt; seize"            
 [3] "power =&gt; extracted"          "power =&gt; wealth"            
 [5] "citizens =&gt; sanctuary"       "funding =&gt; unlimited"       
 [7] "system =&gt; deliver"           "system =&gt; teaches"          
 [9] "betrayal =&gt; horrible"        "integrity =&gt; competency"    
[11] "crisis =&gt; dignity"           "hope =&gt; prosperity"         
[13] "hope =&gt; citizens"            "restoration =&gt; revolution"  
[15] "emergency =&gt; border"         "process =&gt; returning"       
[17] "millions =&gt; millions"        "millions =&gt; aliens"         
[19] "practice =&gt; catch"           "invasion =&gt; disastrous"     
[21] "presence =&gt; gangs"           "crime =&gt; devastating"       
[23] "members =&gt; cabinet"          "powers =&gt; vast"             
[25] "what =&gt; inflation"           "pledge =&gt; sacred"           
[27] "tariffs =&gt; duties"           "tariffs =&gt; revenues"        
[29] "competence =&gt; effectiveness" "race =&gt; engineer"           
[31] "race =&gt; gender"              "society =&gt; colorblind"      
[33] "members =&gt; expelled"         "military =&gt; strongest"      
[35] "place =&gt; rightful"           "awe =&gt; admiration"          
[37] "McKinley =&gt; belongs"         "epidemic =&gt; chronic"        
[39] "flag =&gt; horizons"            "destiny =&gt; manifest"        
[41] "group =&gt; colonies"           "dangers =&gt; deserts"         
[43] "dangers =&gt; braved"           "dangers =&gt; untold"          
[45] "comeback =&gt; historic"        "spirit =&gt; pride"            
[47] "railroads =&gt; raised"         "fascism =&gt; communism"       
[49] "spirit =&gt; unity"            </code></pre>
</div>
</div>
<p>By applying a similar method, we can investigate how adjectives describing “economy” differ in speeches by Democratic and Republican politicians. This allows us to analyze whether the two parties emphasize distinct characteristics of the same topic, potentially reflecting ideological differences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Democratic</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>annoData <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    annotated<span class="sc">$</span>token,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"doc_id"</span> <span class="ot">=</span> <span class="st">"doc_id"</span>, <span class="st">"sid"</span> <span class="ot">=</span> <span class="st">"sid"</span>, <span class="st">"tid"</span> <span class="ot">=</span> <span class="st">"tid_source"</span>),</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"_source"</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Party <span class="sc">==</span> <span class="st">"Democratic"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(lemma <span class="sc">==</span> <span class="st">"economy"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter for adjectives (ADJ) modifying 'economy' via 'amod' relation</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(relation_source <span class="sc">==</span> <span class="st">"amod"</span> <span class="sc">&amp;</span> upos_source <span class="sc">==</span> <span class="st">"ADJ"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select relevant columns: doc_id, the noun ('economy'), and the adjective</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">doc_id =</span> doc_id, <span class="at">noun =</span> token, <span class="at">adj =</span> token_source)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  doc_id    noun        adj
1     11 economy     strict
2     17 economy      rigid
3     27 economy     strict
4     37 economy   national
5     53 economy productive
6     57 economy     modern</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Republican</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>annoData <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    annotated<span class="sc">$</span>token,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"doc_id"</span> <span class="ot">=</span> <span class="st">"doc_id"</span>, <span class="st">"sid"</span> <span class="ot">=</span> <span class="st">"sid"</span>, <span class="st">"tid"</span> <span class="ot">=</span> <span class="st">"tid_source"</span>),</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"_source"</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Party <span class="sc">==</span> <span class="st">"Republican"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(lemma <span class="sc">==</span> <span class="st">"economy"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter for adjectives (ADJ) modifying 'economy' via 'amod' relation</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(relation_source <span class="sc">==</span> <span class="st">"amod"</span> <span class="sc">&amp;</span> upos_source <span class="sc">==</span> <span class="st">"ADJ"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select relevant columns: doc_id, the noun ('economy'), and the adjective</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">doc_id =</span> doc_id, <span class="at">noun =</span> token, <span class="at">adj =</span> token_source)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   doc_id    noun       adj
1      23 economy      wise
2      23 economy    public
3      24 economy     rigid
4      28 economy  severest
5      29 economy    strict
6      34 economy     rigid
7      35 economy   drastic
8      35 economy   greater
9      46 economy    modern
10     49 economy   healthy
11     49 economy strongest
12     50 economy   dynamic</code></pre>
</div>
</div>
</section>
<section id="visualizing-dependency-trees" class="level1">
<h1>Visualizing Dependency Trees</h1>
<p>Visualizing dependency trees can help us better understand the syntactic structure of sentences and how different words relate to each other. Dependency trees show which words are the “head” of a phrase and which words are dependents, along with the types of relationships (like subject, object, etc.) between them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(udpipe)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsyntax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>rsyntax uses the data.table package, but limits the number of threads used:
    - data.table currently uses 5 threads
    - rsyntax uses 2 threads

You can use set_rsyntax_threads() to use all data.table threads, or set a specific number</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rsyntax'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:tidyr':

    chop, fill</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ggplot2':

    annotate</code></pre>
</div>
</div>
<p>Now we can annotate text and visualize the dependency tree</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>text1 <span class="ot">&lt;-</span> <span class="st">"Barack Obama was the 44th President of the United States."</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>text2 <span class="ot">&lt;-</span> <span class="st">"BAGHDAD. Iraqi leaders criticized Turkey on Monday for bombing Kurdish militants in northern Iraq with airstrikes that they said had left at least one woman dead."</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>tokens1 <span class="ot">&lt;-</span> <span class="fu">udpipe</span>(text1,<span class="st">'english'</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>tokens2 <span class="ot">&lt;-</span> <span class="fu">udpipe</span>(text2,<span class="st">'english'</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co">#rsyntax requires the tokens to be in a certain format. The as_tokenindex() function converts a data.frame to this format. </span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>tokens1 <span class="ot">&lt;-</span> <span class="fu">as_tokenindex</span>(tokens1)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>tokens2 <span class="ot">&lt;-</span> <span class="fu">as_tokenindex</span>(tokens2)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualization</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_tree</span>(tokens1, token, lemma, upos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Document: doc1
Sentence: 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_tree</span>(tokens2, token, lemma, upos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Document: doc1
Sentence: 1</code></pre>
</div>
</div>
<p>Note that this function only prints one sentence a time, so if the sentence is not specified it uses the first sentence in the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>second_sentence <span class="ot">&lt;-</span> tokens2[tokens2<span class="sc">$</span>sentence <span class="sc">==</span> <span class="dv">2</span>, ]</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_tree</span>(second_sentence, token, lemma, upos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Document: doc1
Sentence: 2</code></pre>
</div>
</div>
</section>
<section id="named-entity-recognition-ner" class="level1">
<h1>Named Entity Recognition (NER)</h1>
<p>Named Entity Recognition (NER) is a key task in natural language processing (NLP) that involves identifying and categorizing entities in text, such as people, organizations, locations, dates, and more. While tools like udpipe excel in tasks like part-of-speech tagging and dependency parsing, they are limited in their ability to perform NER. Udpipe models do not consistently include NER capabilities, making them less suited for entity recognition tasks.</p>
<p>In contrast, spacy is a more robust option for NER. It provides high-performance models specifically designed for recognizing named entities in text. Spacy’s NER models can classify entities into a variety of categories, such as PERSON, ORG (organization), and LOC (location), making it an excellent tool for tasks that require precise entity extraction. Switching to spacy for NER ensures more accurate and reliable results, especially when working with real-world text data.</p>
<p>Remember we mentioned at the beginning of the tutorial, spacy requires a Python environment. Make sure you have Python installed on your device, and run <code>pip install cleannlp</code> in your terminal or Python to install the <code>cleannlp</code> Python module.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the spacy model</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co">#reticulate::py_install("spacy")</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cnlp_download_spacy</span>(<span class="st">"en_core_web_sm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[38;5;2m✔ Download and installation successful[0m
You can now load the package via spacy.load('en_core_web_sm')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize spacy backend</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co">#reticulate::py_install("cleannlp")</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cnlp_init_spacy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we start with some easy tasks:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>text1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Barack Obama was the 44th President of the United States."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>text_anno1 <span class="ot">&lt;-</span> <span class="fu">cnlp_annotate</span>(text1)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(text_anno1<span class="sc">$</span>entity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 6
  doc_id   sid   tid tid_end entity_type entity           
   &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;            
1      1     1     1       2 PERSON      Barack Obama     
2      1     1     5       5 ORDINAL     44th             
3      1     1     8      10 GPE         the United States</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>text2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "BAGHDAD. Iraqi leaders criticized Turkey on Monday for bombing Kurdish militants in northern Iraq with airstrikes that they said had left at least one woman dead."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>text_anno2 <span class="ot">&lt;-</span> <span class="fu">cnlp_annotate</span>(text2)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>text_anno2<span class="sc">$</span>entity</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 6
  doc_id   sid   tid tid_end entity_type entity      
*  &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;       
1      1     1     1       1 GPE         BAGHDAD     
2      1     2     1       1 NORP        Iraqi       
3      1     2     4       4 GPE         Turkey      
4      1     2     6       6 DATE        Monday      
5      1     2     9       9 NORP        Kurdish     
6      1     2    13      13 GPE         Iraq        
7      1     2    21      23 CARDINAL    at least one</code></pre>
</div>
</div>
<p>Now let’s look into the top <strong>person</strong> mentioned by the Democratic and Republican Party</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>annotated_spacy <span class="ot">&lt;-</span> <span class="fu">cnlp_annotate</span>(myData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Processed document 10 of 60
Processed document 20 of 60
Processed document 30 of 60
Processed document 40 of 60
Processed document 50 of 60
Processed document 60 of 60</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>annoData_spacy <span class="ot">&lt;-</span> <span class="fu">left_join</span>(annotated_spacy<span class="sc">$</span>document,</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>                            annotated_spacy<span class="sc">$</span>entity, </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">by =</span><span class="st">"doc_id"</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(annoData_spacy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Year  President FirstName Party doc_id sid tid tid_end entity_type
1 1789 Washington    George  none      1   1   1       3         ORG
2 1789 Washington    George  none      1   1   6       6         ORG
3 1789 Washington    George  none      1   1   9      12         ORG
4 1789 Washington    George  none      1   1  45      47        DATE
5 1789 Washington    George  none      1   1  49      51        DATE
6 1789 Washington    George  none      1   2  55      55        DATE
                        entity
1              Fellow-Citizens
2                       Senate
3 the House of Representatives
4                 the 14th day
5            the present month
6                        years</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Democratic</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>annoData_spacy <span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(entity_type <span class="sc">==</span> <span class="st">"PERSON"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Party <span class="sc">==</span> <span class="st">"Democratic"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(entity) <span class="sc">%&gt;%</span> </span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="at">n=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Selecting by count</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 44 × 2
   entity             count
   &lt;chr&gt;              &lt;int&gt;
 1 Bush                   2
 2 Chief Justice          2
 3 George Washington      2
 4 God                    2
 5 Abraham Lincoln        1
 6 Administrations        1
 7 Biden                  1
 8 Cardinal Bernardin     1
 9 Carter                 1
10 Comfort                1
# ℹ 34 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Republican</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>annoData_spacy <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(entity_type <span class="sc">==</span> <span class="st">"PERSON"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Party <span class="sc">==</span> <span class="st">"Republican"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(entity) <span class="sc">%&gt;%</span> </span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="at">n=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Selecting by count</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 2
   entity            count
   &lt;chr&gt;             &lt;int&gt;
 1 Bush                  5
 2 Clinton               5
 3 Speaker               4
 4 Abraham Lincoln       3
 5 Chief Justice         3
 6 George Washington     3
 7 God                   3
 8 Jefferson             3
 9 Obama                 3
10 Administrations       2
11 Carter                2
12 Dole                  2
13 Johnson               2
14 Mathias               2
15 Monroe                2
16 O'Neill               2
17 Roberts               2
18 Thomas Jefferson      2</code></pre>
</div>
</div>
</section>
<section id="string-operations" class="level1">
<h1>String Operations</h1>
<p>To this point, we’ve worked on getting our text into R, getting some basic statistics out, and annotating that text. One thing we have skipped past is a really foundational tool in programming, regular expressions. The idea here is to create a pattern of text that we can search for. To see what we can do with regular expressions, let’s start playing with them.</p>
<p>We are going to use the stringr library, which is associated with the tidyverse. To be clear, a lot of what we do could be done in base R, but the language for the base R functions (grep(),gsub()`, etc.) can be far less intuitive.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="whats-in-a-string" class="level2">
<h2 class="anchored" data-anchor-id="whats-in-a-string">What’s in a string?</h2>
<p>Let’s look at some simpler data first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(sentences)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 720</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sentences)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The birch canoe slid on the smooth planks." 
[2] "Glue the sheet to the dark blue background."
[3] "It's easy to tell the depth of a well."     
[4] "These days a chicken leg is a rare dish."   
[5] "Rice is often served in round bowls."       
[6] "The juice of lemons makes fine punch."      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>string <span class="ot">&lt;-</span> <span class="st">'It</span><span class="sc">\'</span><span class="st">s easy to tell the depth of a well.'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As you can see, <code>sentences</code> contains 720 short and simple sentences. We’ll use these to illustrate regular expressions. A first thing to note is the string. See that \? That’s an escape, and tells R to ignore the single quote. Why is this important? Well, notice what demarcates each sentence that’s being printed. That’s right, single quotes! So the \ let’s R know that the element is not yet complete. That doesn’t mean the \ is always there though. If you want to see the “printed” version of the sentence, you can use writeLines()</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="fu">head</span>(sentences))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The birch canoe slid on the smooth planks.
Glue the sheet to the dark blue background.
It's easy to tell the depth of a well.
These days a chicken leg is a rare dish.
Rice is often served in round bowls.
The juice of lemons makes fine punch.</code></pre>
</div>
</div>
<p>There are lots of other special characters that may require escapes in R if you are doing regular expression matching. That can be particularly challenging because of the special meanings of those special characters — like the single quote — leads to particular operations. As an example, the single period . in a regular expression is a <em>wild card</em> for character matching, and will match any character but a newline. Therefore, if you include the . in a regular expression without escaping it, you’ll end up matching just about everything. The cheat sheet posted to the course website gives more details on these special characters.</p>
</section>
<section id="combining-strings" class="level2">
<h2 class="anchored" data-anchor-id="combining-strings">Combining strings</h2>
<p>Now that we have our strings, let’s do some basic operations. We can combine two strings using the str_c command in stringr. For instance, if we wanted to combine the first two sentences from sentences, we could.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(sentences[<span class="dv">1</span>], sentences[<span class="dv">2</span>], <span class="at">sep =</span> <span class="st">" "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The birch canoe slid on the smooth planks. Glue the sheet to the dark blue background."</code></pre>
</div>
</div>
<p>This also works if we have two separate string vectors that we’d like to combine. Imagine if we split <code>sentences</code> in half; we could combine the two halves! This is often really helpful if you have a couple of character / string variables in your dataset / metadata that you’d like to combine into a single indicator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>sentencesA <span class="ot">&lt;-</span> sentences[<span class="dv">1</span><span class="sc">:</span><span class="dv">360</span>]</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>sentencesB <span class="ot">&lt;-</span> sentences[<span class="dv">361</span><span class="sc">:</span><span class="dv">720</span>]</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">str_c</span>(sentencesA, sentencesB, <span class="at">sep =</span> <span class="st">" "</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The birch canoe slid on the smooth planks. Feed the white mouse some flower seeds."     
[2] "Glue the sheet to the dark blue background. The thaw came early and freed the stream."  
[3] "It's easy to tell the depth of a well. He took the lead and kept it the whole distance."
[4] "These days a chicken leg is a rare dish. The key you designed will fit the lock."       
[5] "Rice is often served in round bowls. Plead to the council to free the poor thief."      
[6] "The juice of lemons makes fine punch. Better hash is made of rare beef."                </code></pre>
</div>
</div>
<p>You can also combine all of the strings in one vector into a single observation using the <code>collapse</code> option.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">str_c</span>(<span class="fu">head</span>(sentences), <span class="at">collapse =</span> <span class="st">" "</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the string in collapse is up to you but is what will be pasted </span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="co"># between the elements in the new string. So here's a version with a new line</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co"># which gets specified by \n</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(<span class="fu">head</span>(sentences), <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The birch canoe slid on the smooth planks.\nGlue the sheet to the dark blue background.\nIt's easy to tell the depth of a well.\nThese days a chicken leg is a rare dish.\nRice is often served in round bowls.\nThe juice of lemons makes fine punch."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># and here's what that looks like with writeLines() then</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="fu">str_c</span>(<span class="fu">head</span>(sentences), <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The birch canoe slid on the smooth planks.
Glue the sheet to the dark blue background.
It's easy to tell the depth of a well.
These days a chicken leg is a rare dish.
Rice is often served in round bowls.
The juice of lemons makes fine punch.</code></pre>
</div>
</div>
<p>You can also do the opposite, splitting a string into two by using <code>str_split()</code> and identifying a common splitting indicator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create combined string</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>combined_string <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="fu">head</span>(sentences), <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>combined_string</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The birch canoe slid on the smooth planks.\nGlue the sheet to the dark blue background.\nIt's easy to tell the depth of a well.\nThese days a chicken leg is a rare dish.\nRice is often served in round bowls.\nThe juice of lemons makes fine punch."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create split string; simplify = TRUE returns a matrix (rather than a list)</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>split_string <span class="ot">&lt;-</span> <span class="fu">str_split</span>(combined_string, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">simplify =</span> <span class="cn">TRUE</span>)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>split_string</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]                                        
[1,] "The birch canoe slid on the smooth planks."
     [,2]                                         
[1,] "Glue the sheet to the dark blue background."
     [,3]                                    
[1,] "It's easy to tell the depth of a well."
     [,4]                                      
[1,] "These days a chicken leg is a rare dish."
     [,5]                                  
[1,] "Rice is often served in round bowls."
     [,6]                                   
[1,] "The juice of lemons makes fine punch."</code></pre>
</div>
</div>
</section>
<section id="substrings" class="level2">
<h2 class="anchored" data-anchor-id="substrings">Substrings</h2>
<p>Occassionally, we need to pull out parts of strings. For instance, maybe we just want the first few letters of each string. In those instances, we can use <code>str_sub()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># example string this actually makes some sense for</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>month.name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "January"   "February"  "March"     "April"     "May"       "June"     
 [7] "July"      "August"    "September" "October"   "November"  "December" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># substring the first three letters</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>short_months <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(month.name, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>short_months</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Jan" "Feb" "Mar" "Apr" "May" "Jun" "Jul" "Aug" "Sep" "Oct" "Nov" "Dec"</code></pre>
</div>
</div>
<p>You can also use <code>str_sub()</code> to change a string through replacement of specific characters. Here we’ll replace the first few letters of every month with “Cat”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>year_of_cat <span class="ot">&lt;-</span> month.name</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(year_of_cat, <span class="dv">1</span>, <span class="dv">2</span>) <span class="ot">&lt;-</span> <span class="st">"Cat"</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>year_of_cat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Catnuary"   "Catbruary"  "Catrch"     "Catril"     "Caty"      
 [6] "Catne"      "Catly"      "Catgust"    "Catptember" "Cattober"  
[11] "Catvember"  "Catcember" </code></pre>
</div>
</div>
</section>
<section id="pattern-searches" class="level2">
<h2 class="anchored" data-anchor-id="pattern-searches">Pattern searches</h2>
<p>Where regular expressions really kick in isn’t with these sorts of operations though. It’s in searching for specific patterns. Let’s start illustrating by looking at one type of pattern: a word! To illustrate these pattern searches, we’ll use another set of words, a vector of names of fruit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>fruit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "apple"             "apricot"           "avocado"          
 [4] "banana"            "bell pepper"       "bilberry"         
 [7] "blackberry"        "blackcurrant"      "blood orange"     
[10] "blueberry"         "boysenberry"       "breadfruit"       
[13] "canary melon"      "cantaloupe"        "cherimoya"        
[16] "cherry"            "chili pepper"      "clementine"       
[19] "cloudberry"        "coconut"           "cranberry"        
[22] "cucumber"          "currant"           "damson"           
[25] "date"              "dragonfruit"       "durian"           
[28] "eggplant"          "elderberry"        "feijoa"           
[31] "fig"               "goji berry"        "gooseberry"       
[34] "grape"             "grapefruit"        "guava"            
[37] "honeydew"          "huckleberry"       "jackfruit"        
[40] "jambul"            "jujube"            "kiwi fruit"       
[43] "kumquat"           "lemon"             "lime"             
[46] "loquat"            "lychee"            "mandarine"        
[49] "mango"             "mulberry"          "nectarine"        
[52] "nut"               "olive"             "orange"           
[55] "pamelo"            "papaya"            "passionfruit"     
[58] "peach"             "pear"              "persimmon"        
[61] "physalis"          "pineapple"         "plum"             
[64] "pomegranate"       "pomelo"            "purple mangosteen"
[67] "quince"            "raisin"            "rambutan"         
[70] "raspberry"         "redcurrant"        "rock melon"       
[73] "salal berry"       "satsuma"           "star fruit"       
[76] "strawberry"        "tamarillo"         "tangerine"        
[79] "ugli fruit"        "watermelon"       </code></pre>
</div>
</div>
<p>We can look to see which include the string berry in their name in a whole lot of different ways.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># which elements in the vector have berry in the name</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">str_which</span>(fruit, <span class="st">"berry"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># does the fruit contain the string `berry`</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(fruit, <span class="st">"berry"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE  TRUE  TRUE FALSE
[13] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE  TRUE FALSE FALSE FALSE
[25] FALSE FALSE FALSE FALSE  TRUE FALSE FALSE  TRUE  TRUE FALSE FALSE FALSE
[37] FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[49] FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[61] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE
[73]  TRUE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># name the fruits that contain the string `berry`</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(fruit, <span class="st">"berry"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "bilberry"    "blackberry"  "blueberry"   "boysenberry" "cloudberry" 
 [6] "cranberry"   "elderberry"  "goji berry"  "gooseberry"  "huckleberry"
[11] "mulberry"    "raspberry"   "salal berry" "strawberry" </code></pre>
</div>
</div>
</section>
</section>
<section id="regular-expressions" class="level1">
<h1>Regular Expressions</h1>
<p>Now we can try to generalize beyond the simple word case to broader patterns. These can capture more complex phenomena, which are often what we need when we are doing work with text-as-data.</p>
<p>To illustrate, we’ll go back to the sentences data from earlier. Now let’s look for any sentences that contain “hog”, “bog”, “log”, or “dog”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># note that the spaces are important within the quotes below. what happens if you remove them? Why?</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(sentences, <span class="st">' [hbd]og '</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The hog crawled under the high fence."     
[2] "The kitten chased the dog down the street."
[3] "Tend the sheep while the dog wanders."     </code></pre>
</div>
</div>
<p>We can also negate the letters we’re using above by using ^, looking for any words that do not start with h, b, d, or l but that do end with -og. Or we can use - to look across a range of characters</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">str_subset</span>(sentences, <span class="st">'[^hbdl]og'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># look for anything between b and l</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(sentences, <span class="st">' [b-l]ot '</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "The wide road shimmered in the hot sun."  
 [2] "Move the vat over the hot fire."          
 [3] "The harder he tried the less he got done."
 [4] "The just claim got the right verdict."    
 [5] "A shower of dirt fell from the hot pipes."
 [6] "The large house had hot water taps."      
 [7] "The lake sparkled in the red hot sun."    
 [8] "It takes a lot of help to finish these."  
 [9] "Serve the hot rum to the tired heroes."   
[10] "Twist the valve and release hot steam."   
[11] "Breakfast buns are fine with a hot drink."
[12] "The beetle droned in the hot June sun."   </code></pre>
</div>
</div>
<section id="classes-and-quantifiers" class="level2">
<h2 class="anchored" data-anchor-id="classes-and-quantifiers">Classes and quantifiers</h2>
<p>There are also a series of escaped characters that have special meanings. These let you match, for example, any alphanumeric character (), any space (), or any number (. These become really helpful when combined with quantifiers, which indicate the number of occurrences of the character. On this, * indicates zero or more of the character, and + indicates one more of the character.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create some strings</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>tutone <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Jenny Jenny, who can I turn to?"</span>, <span class="st">"867-5309"</span>)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="co"># match any number string of more than one number</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract_all</span>(tutone, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
character(0)

[[2]]
[1] "867"  "5309"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># match any alphanumeric string of 0 or more</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract_all</span>(tutone, <span class="st">"</span><span class="sc">\\</span><span class="st">w*"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
 [1] "Jenny" ""      "Jenny" ""      ""      "who"   ""      "can"   ""     
[10] "I"     ""      "turn"  ""      "to"    ""      ""     

[[2]]
[1] "867"  ""     "5309" ""    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># match any number string of more than three numbers; note the comma</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract_all</span>(tutone, <span class="st">"</span><span class="sc">\\</span><span class="st">d{4,}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
character(0)

[[2]]
[1] "5309"</code></pre>
</div>
</div>
</section>
<section id="extracting-data" class="level2">
<h2 class="anchored" data-anchor-id="extracting-data">Extracting data</h2>
<p>Where regular expressions start to get really powerful for us is in automating the extraction of information from rich digital text. Consider an example where we want to identify mentions of courts from inaugural addresses. We can leverage regular expressions to do just that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_match</span>(text, <span class="st">" [C|c]ourt[s]*|[J|j]udicia[</span><span class="sc">\\</span><span class="st">w]+ "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]        
 [1,] NA          
 [2,] NA          
 [3,] NA          
 [4,] NA          
 [5,] NA          
 [6,] NA          
 [7,] " court"    
 [8,] NA          
 [9,] NA          
[10,] "judiciary "
[11,] NA          
[12,] NA          
[13,] "judicial " 
[14,] "judiciary "
[15,] NA          
[16,] "judicial " 
[17,] NA          
[18,] "judicial " 
[19,] " Court"    
[20,] NA          
[21,] NA          
[22,] NA          
[23,] NA          
[24,] " court"    
[25,] NA          
[26,] "judicial " 
[27,] " courts"   
[28,] " courts"   
[29,] NA          
[30,] NA          
[31,] " courts"   
[32,] NA          
[33,] NA          
[34,] " court"    
[35,] " Court"    
[36,] "judicial " 
[37,] " court"    
[38,] NA          
[39,] NA          
[40,] NA          
[41,] NA          
[42,] NA          
[43,] NA          
[44,] NA          
[45,] NA          
[46,] NA          
[47,] NA          
[48,] NA          
[49,] NA          
[50,] NA          
[51,] NA          
[52,] NA          
[53,] NA          
[54,] NA          
[55,] NA          
[56,] NA          
[57,] NA          
[58,] NA          
[59,] NA          
[60,] " Court"    </code></pre>
</div>
</div>
<p>While that isn’t necessarily the most useful, consider if you were looking instead for something like the authors of each text, where the author was featured in a consistent format at the start of each text. While you could go through by hand and code each of those, it is much more straightforward to do this with regular expressions. As you start working with your corpus — and particularly if you are in any way thinking of coding something by hand from the corpus — take some time to think and to chat with me about whether it’s something we can do with regular expressions.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>